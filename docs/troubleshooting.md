# Устранение неполадок

## Циклическое перенаправление (Firefox / «редирект никогда не завершится»)

**Причина:** Часто из‑за отключённых или запрещённых cookie: браузер не принимает ответ с очисткой сессии, старый cookie остаётся → редирект на логин → снова редирект на защищённую страницу → цикл.

**Что сделать:** Включите приём cookie для этого сайта (localhost:3000) или откройте вручную **http://localhost:3000/login?cleared=1** — так цикл разрывается и отображается страница входа.

## JWTSessionError: no matching decryption secret

**Причина:** Браузер отправляет cookie сессии, зашифрованный другим секретом (другой `AUTH_SECRET` или сессия от другого приложения на том же `localhost:3000`).

**Что сделать:**

1. **Очистить cookies для localhost:3000**
   - Chrome/Edge: F12 → вкладка **Application** → слева **Storage** → **Cookies** → `http://localhost:3000` → правый клик → **Clear** (или удалить вручную cookies с именами `authjs.session-token`, `__Secure-authjs.session-token`).
   - Firefox: F12 → **Storage** → **Cookies** → `http://localhost:3000` → удалить нужные.
   - Либо один раз открыть в этой вкладке: **http://localhost:3000/api/auth/clear-session** (страница перенаправит на логин и очистит сессию).

2. **Проверить AUTH_SECRET в `.env`**
   - Должен быть сгенерированный секрет, не строка-подсказка. Выполнить в корне проекта: `npx auth secret` и подставить вывод в `AUTH_SECRET`.

3. Перезапустить dev-сервер и снова войти.
